{% extends "base.html" %}

{% block title1 %} 拖曳上傳檔案{% endblock %}
{% block head %}
<style>
	#dropzone {
		border: 2px dashed #ccc;
		padding: 20px;
		margin-top: 50px;
		text-align: center;
		font-size: 18px;
		font-weight: bold;
		color: #ccc;
	}
	#dropzone.highlight {
		border-color: #66ccff;
		color: #66ccff;
	}
</style>
{% endblock %}
{% block content %}
<body>
	<div class="row mt-3">
        <div class="col-md-12">
            <h1>上傳檔案</h1>
        </div>
    </div>
	<div class="container">
		<div id="dropzone">拖曳檔案到這裡上傳</div>
		<div id="progress"></div>
		<div id="message"></div>
	</div>
	<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.0/js/bootstrap.bundle.min.js"></script>
	<script>
		var dropzone = $('#dropzone');
		var progress = $('#progress');
		var message = $('#message');

		// 防止瀏覽器預設的拖曳事件
		$(document).on('dragenter', function(e) {
			e.stopPropagation();
			e.preventDefault();
			dropzone.addClass('highlight');
		});
		$(document).on('dragover', function(e) {
			e.stopPropagation();
			e.preventDefault();
			dropzone.addClass('highlight');
		});
		$(document).on('dragleave', function(e) {
			e.stopPropagation();
			e.preventDefault();
			dropzone.removeClass('highlight');
		});

		// 拖曳上傳檔案
        dropzone.on('drop', function(e) {
        e.stopPropagation();
        e.preventDefault();
        dropzone.removeClass('highlight');
        var files = e.originalEvent.dataTransfer.files;
var formData = new FormData();
for (var i = 0; i < files.length; i++) {
	formData.append('file[]', files[i]);
}

// 透過 AJAX 上傳檔案
$.ajax({
	url: '/upload',
	type: 'POST',
	data: formData,
	processData: false,
	contentType: false,
	xhr: function() {
		var xhr = $.ajaxSettings.xhr();
		if (xhr.upload) {
			xhr.upload.addEventListener('progress', function(e) {
				var percent = Math.round((e.loaded / e.total) * 100);
				progress.html(percent + '%');
			}, false);
		}
		return xhr;
	},
	success: function(data) {
		message.html(data);
	}
});
});
</script>
{% endblock %}